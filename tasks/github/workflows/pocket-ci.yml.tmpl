# Code generated by pocket. DO NOT EDIT.
# Run `./pok github-ci` to regenerate.
# See: https://github.com/fredrikaverpil/pocket

name: pocket-ci

on:
  push:
    branches: [main, master]
  pull_request:

permissions:
  contents: read

{{- if .SplitTasks }}

jobs:
  # Run each task as a separate parallel job across all platform/shell combinations
{{- range $i, $task := .Tasks }}
  {{ $task }}:
    runs-on: {{` ${{ matrix.os }}`}}
    strategy:
      fail-fast: {{ $.FailFast }}
      matrix:
        include:
{{- range $.Matrix }}
          - os: {{ .OS }}
            shell: {{ .Shell }}
            pok: {{ .Pok }}
{{- end }}
    steps:
      - uses: actions/checkout@v4
      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version-file: .pocket/go.mod
          cache-dependency-path: '**/go.sum'
{{- if $.InstallShells }}
      - name: Install shells (Linux)
        if: runner.os == 'Linux'
        run: |
          sudo apt-get update
          sudo apt-get install -y zsh fish
{{- end }}
      - name: Run {{ $task }}
        shell: {{` ${{ matrix.shell }}`}}
        run: {{` ${{ matrix.pok }}`}} -v {{ $task }}
{{- end }}

{{- else }}

jobs:
  pocket:
    runs-on: {{` ${{ matrix.os }}`}}
    strategy:
      fail-fast: {{ .FailFast }}
      matrix:
        include:
{{- range .Matrix }}
          - os: {{ .OS }}
            shell: {{ .Shell }}
            pok: {{ .Pok }}
{{- end }}
    steps:
      - uses: actions/checkout@v4
      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version-file: .pocket/go.mod
          cache-dependency-path: '**/go.sum'
{{- if .InstallShells }}
      - name: Install shells (Linux)
        if: runner.os == 'Linux'
        run: |
          sudo apt-get update
          sudo apt-get install -y zsh fish
{{- end }}
      - name: Run pocket
        shell: {{` ${{ matrix.shell }}`}}
        run: {{` ${{ matrix.pok }}`}} -v
{{- end }}
